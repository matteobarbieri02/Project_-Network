---
title: "Project_network"
author: "Barbieri, Bonatti"
date: "2024-06-03"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```

```{r}
install.packages("devtools")
```

```{r}
devtools::install_github("pj398/movienetdata")

library(movienetdata)


data <- data(package = "movienetdata")
head(data)

data("mcu01_ironman", package = "movienetdata")

iron <- data("mcu01_ironman", package = "movienetdata")

head(mcu01_ironman)
```
links

```{r}
str(mcu01_ironman)

# Print the entire dataset to see all links (if it's not too large)
print(mcu01_ironman)
```




```{r}
# Extract node_list and adjacency matrix
nodes <- mcu01_ironman$node_list

# Rename the column 'value' in the nodes dataframe

nodes<- rename(nodes, "value_node" = "value") 

adjacency_matrix <- mcu01_ironman$adjacency

event_list <- mcu01_ironman$event_list

# Create links from adjacency matrix
# Assuming the adjacency matrix is binary (0 or 1) and symmetric for undirected graph
links <- which(adjacency_matrix == 1, arr.ind = TRUE)
links <- as.data.frame(links)
colnames(links) <- c("from", "to")

# Remove self-loops (where from == to)
links <- links[links$from != links$to, ]

# Optionally, if the graph is undirected, remove duplicate edges
links <- links[!duplicated(t(apply(links, 1, sort))), ]

# Increment the node indices by 1 to match R's 1-based indexing
links$from <- links$from + 1
links$to <- links$to + 1

# Calculate the value for each link based on event_list
calculate_value <- function(event_list, from, to) {
  sum(sapply(event_list, function(event) {
    from %in% event & to %in% event
  }))
}

# Apply the calculation for each link
links$value <- mapply(calculate_value, list(event_list), links$from, links$to)


# Inspect the nodes
head(nodes)

# Inspect the links
head(links)
```
Il data frame links ha due colonne principali:

 - from: L'indice del nodo da cui parte il collegamento.
 
 - to: L'indice del nodo a cui arriva il collegamento.

Ogni riga rappresenta un singolo collegamento (edge) tra due nodi.


```{r}
# Get the nodes by name
mcu01_ironman$node_list
```

nodes contain the following information(5 columns): 

 - 1. character_ID:
 - 2. char_name: Name of the character 
 - 3. char_female: dummy varible (gender)
 - 4. nlines: total lines spoken (nlines), total times spoken to (linesin),
 - 5. total times spoken to (linesin)
```{r}
# Get the nodes by indexing
mcu01_ironman[[2]]
```


```{r}
help("mcu01_ironman")
```


```{r}
data


mcu16_spiderman[[2]]

head(mcu16_spiderman$node_list)


ironman <- movienetdata::mcu01_ironman
# install.packages("network")
library(network)
# Create network object from adjacency matrix
bp_net <- network(ironman$adjacency)
# Plot the network
plot(bp_net, label = ironman[[2]]$char_name, 
     edge.col = "lightpink1", 
     vertex.cex = sqrt(ironman[[2]]$nlines)/3, 
     label.pos = 3, arrowhead.cex = 0.7,
     vertex.col = ifelse(ironman[[2]]$char_female == 1, 
                         "#ded649", "#55467a"), 
     main = "Character interactions in Black Panther (2018)")

```


```{r}
library(igraph)
library(dplyr)

# Load the dataset
data("mcu01_ironman", package = "movienetdata")

# Extract node_list and adjacency matrix
nodes <- mcu01_ironman$node_list
adjacency_matrix <- mcu01_ironman$adjacency
event_list <- mcu01_ironman$event_list

# Create links from adjacency matrix
links <- which(adjacency_matrix == 1, arr.ind = TRUE)
links <- as.data.frame(links)
colnames(links) <- c("from", "to")

# Remove self-loops (where from == to)
links <- links[links$from != links$to, ]

# Optionally, if the graph is undirected, remove duplicate edges
links <- links[!duplicated(t(apply(links, 1, sort))), ]

# Increment the node indices by 1 to match R's 1-based indexing
links$from <- links$from + 1
links$to <- links$to + 1

# Calculate the value for each link based on event_list
calculate_value <- function(event_list, from, to) {
  sum(sapply(event_list, function(event) {
    from %in% event & to %in% event
  }))
}

# Apply the calculation for each link
links$value <- mapply(calculate_value, list(event_list), links$from, links$to)

# Create the unweighted graph
unweighted_graph <- graph_from_data_frame(d = links[, c("from", "to")], directed = FALSE, vertices = nodes)

# Create the weighted graph
weighted_graph <- graph_from_data_frame(d = links, directed = FALSE, vertices = nodes)
E(weighted_graph)$weight <- links$value

# Plot the unweighted graph
plot(unweighted_graph, vertex.label = V(unweighted_graph)$name, main = "Unweighted Graph")

# Plot the weighted graph
plot(weighted_graph, vertex.label = V(weighted_graph)$name, edge.width = E(weighted_graph)$weight, main = "Weighted Graph")

# Print summary of the graphs
summary(unweighted_graph)
summary(weighted_graph)

# Display the first few rows of nodes and links for inspection
head(nodes)
head(links)
```

